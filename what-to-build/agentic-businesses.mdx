---
title: Agentic Businesses
description: "Build AI-powered businesses that run themselves."
---

### Step 1: Create Your App

1. Go to https://whop.com/dashboard
2. Navigate to Settings -> API keys
3. Click the Create App button
4. Give your app a name and click Create

### Step 2: Create an Agent User

1. In the API keys section, select Edit on the ... menu for your App
2. Click the Create Agent User button
3. Enter a name and username for the agent user
4. Click Create
5. Note down the User ID - you'll need this for the `x-on-behalf-of` header in API requests

### Step 3: Set Up Your API Environment

Your API requests will need these headers:

```plaintext
Authorization: Bearer YOUR_API_KEY
x-on-behalf-of: YOUR_AGENT_USER_ID
x-company-id: YOUR_COMPANY_ID
Content-Type: application/json
```

### Step 4: Listen for messages (via WebSocket)

To receive messages in real-time, you can connect to our WebSocket.

First, ensure you have the necessary headers defined (as in Step 3). The `Authorization` and `x-on-behalf-of` headers are crucial for WebSocket authentication. Note that `x-company-id` is not needed for the WebSocket connection itself but is good to have for other API calls.

```python
# Headers from Step 3 (ensure WHOP_APP_API_KEY and WHOP_AGENT_USER_ID are set)
# headers = {
#     "Authorization": "Bearer YOUR_API_KEY",
#     "x-on-behalf-of": "YOUR_AGENT_USER_ID",
#     # "x-company-id": "YOUR_COMPANY_ID", # Not used for WebSocket connection
#     "Content-Type": "application/json" # Not strictly needed for WebSocket but good practice
# }

# WebSocket specific headers
ws_headers = {
    "Authorization": f"Bearer YOUR_API_KEY", # Replace with your actual key
    "x-on-behalf-of": "YOUR_AGENT_USER_ID" # Replace with your agent user ID
}
```

Install the required package:
```bash
pip install websockets
```

Then, connect and listen for messages:

```python
import asyncio
import websockets
import json

# Define ws_headers as shown above, using your API key and Agent User ID

async def connect_to_websocket():
    uri = "wss://ws-prod.whop.com/ws/developer"
    try:
        async with websockets.connect(uri, additional_headers=ws_headers) as websocket:
            print(f"Successfully connected to {uri}")
            
            # Keep the connection alive and listen for messages
            while True:
                try:
                    message = await websocket.recv()
                    formatted_message = json.loads(message)
                    print(f"Received: {formatted_message}")
                    # Add your logic here to process the message
                    # For example, to filter DMs:
                    # if "feedEntity" in formatted_message:
                    #     feed_entity = formatted_message["feedEntity"]
                    #     if "dmsPost" in feed_entity:
                    #         dms_post = feed_entity["dmsPost"]
                    #         print(f"DM Post: {dms_post}")
                    #         message_content = dms_post["message"]
                    #         sender_id = dms_post["user"]["id"]
                    #         feed_id = formatted_message["feedId"] # or dms_post.get("feedId")
                                        
                except websockets.exceptions.ConnectionClosed:
                    print("Connection closed")
                    break
    except Exception as e:
        print(f"Failed to connect or error during communication: {e}")

if __name__ == "__main__":
    # Ensure you have your YOUR_API_KEY and YOUR_AGENT_USER_ID defined
    # For example:
    # YOUR_API_KEY = "sk_123..." 
    # YOUR_AGENT_USER_ID = "user_abc..."
    # ws_headers = {
    #    "Authorization": f"Bearer {YOUR_API_KEY}",
    #    "x-on-behalf-of": YOUR_AGENT_USER_ID
    # }
    asyncio.run(connect_to_websocket())
```

This setup will connect to the WebSocket and print any incoming messages. You will receive all messages associated with the authenticated user (defined in `x-on-behalf-of`), including DMs.

**Important Notes:**
- You'll receive messages sent *by* the authenticated user as well. Filter these out in your processing logic if needed, by checking the sender's user ID against your agent's user ID.
- The `ws_headers` should use your actual API key and Agent User ID. The example `headers` from Step 3 can be adapted, or you can create `ws_headers` specifically for the WebSocket.
- You can parse the `formatted_message` JSON to extract details like `feedId`, sender information, message content, etc. The structure for DMs would be nested within `feedEntity.dmsPost`.

### Step 5: Send messages

```graphql
mutation sendMessage {
  sendMessage(
    input: { toUserId: "user_123", message: "Personal engagement message" }
  ) {
    id
  }
}
```

Check out other example calls you can make [here](/api-reference/graphql/examples)
Have questions? Post in the Whop Dev Forum [here](https://whop.com/whop-developer-program/general-chat-RigJuZGl3v6NFz/app/)
